<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Stable-Diffusion Prompt Sorter</title>
<style>
 body{background:#111;color:#eee;font-family:sans-serif;padding:2em}
 input[type=text]{padding:.4em;width:80%;max-width:600px;margin:.3em 0}
 input[type=submit]{padding:.5em 1.2em;margin:.3em 0}
 .grid{display:flex;flex-wrap:wrap;gap:1em;margin-top:1.5em}
 .card{background:#222;padding:1em;border:1px solid #444;width:200px;cursor:pointer}
 .card img{max-width:100%;border:1px solid #333}
 .filename{margin-top:.4em;font-size:.8em;word-break:break-all}
 #modal{display:none;position:fixed;top:10%;left:10%;width:80%;height:80%;
        background:#000;border:2px solid #888;color:#eee;overflow:auto;padding:1em}
 #modal pre{white-space:pre-wrap;font-size:.9em}
</style>
</head>
<body>

<h1>üñºÔ∏è Stable-Diffusion Prompt Sorter</h1>

<!-- Folder picker -->
<form method="POST">
  <input type="text" name="folder" placeholder="Full path to image folder"
         value="{{ folder }}">
  <input type="submit" value="Scan">
</form>

{% if error %}<p style="color:#f66">{{ error }}</p>{% endif %}

{% if images %}
<!-- Tag words box -->
<form method="POST" action="/sort">
  <input type="hidden" name="folder" value="{{ folder }}">
  <label>Move images whose <strong>prompt</strong> contains any of:</label><br>
  <input type="text" name="tags"
         placeholder="e.g. cirno, dragon, landscape"><br>
  <input type="submit" value="Sort Images">
</form>

<!-- Thumbnails -->
<div class="grid">
  {% for img in images %}
  <div class="card"
       onclick="showPrompt('{{ img.full_path | urlencode }}')">
    <img src="/image?path={{ img.full_path | urlencode }}"
         alt="{{ img.filename }}">
    <div class="filename">{{ img.filename }}</div>
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- Prompt modal -->
<div id="modal">
  <button onclick="document.getElementById('modal').style.display='none'">
    close ‚úñ
  </button>
  <h3>Prompt:</h3>
  <pre id="prompttext"></pre>
</div>

<script>
function showPrompt(encodedPath){
  fetch('/prompt',{
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body:'path='+encodedPath
  })
  .then(r=>r.text())
  .then(t=>{
    document.getElementById('prompttext').innerText=t;
    document.getElementById('modal').style.display='block';
  });
}
</script>

</body>
</html>
