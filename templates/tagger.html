<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WD-Tagger Organiser</title>
<style>
 body{background:#111;color:#eee;font-family:sans-serif;padding:2em}
 a{color:#4af}
 input[type=text]{padding:.4em;width:80%;max-width:600px;margin:.3em 0}
 input[type=submit]{padding:.5em 1.2em;margin:.3em 0}
 .grid{display:flex;flex-wrap:wrap;gap:1em;margin-top:1.5em}
 .card{background:#222;padding:1em;border:1px solid #444;width:230px;cursor:pointer}
 .card img{max-width:100%;border:1px solid #333}
 .tags{font-size:.8em;color:#ccc;margin-top:.4em;white-space:pre-wrap}
 .filename{margin-top:.4em;font-size:.8em;word-break:break-all}
 #modal{display:none;position:fixed;top:10%;left:10%;width:80%;height:80%;
        background:#000;border:2px solid #888;color:#eee;overflow:auto;padding:1em}
 #modal pre{white-space:pre-wrap;font-size:.9em}
</style>
</head>
<body>
<h1>üñºÔ∏è WD-Tagger Organiser</h1>
<p><a href="{{ url_for('prompt_page') }}">Switch to Prompt Organiser</a></p>

<form method="POST">
  <input type="text" name="folder" placeholder="Full path to image folder"
         value="{{ folder }}"><br>
  <input type="submit" value="Scan">
</form>

{% if error %}<p style="color:#f66">{{ error }}</p>{% endif %}
{% if images %}
<form method="POST" action="{{ url_for('tagger_sort') }}">
  <input type="hidden" name="folder" value="{{ folder }}">
  <label>Move images whose <strong>tag list</strong> contains:</label><br>
  <input type="text" name="tags" placeholder="e.g. 1girl, landscape"><br>
  <input type="submit" value="Sort Images">
</form>

<div class="grid">
  {% for img in images %}
    <div class="card" onclick="showTags('{{ img.full_path | urlencode }}')">
      <img src="{{ url_for('serve_image') }}?path={{ img.full_path | urlencode }}"
           alt="{{ img.filename }}">
      <div class="tags">{{ ', '.join(img.tags) }}</div>
      <div class="filename">{{ img.filename }}</div>
    </div>
  {% endfor %}
</div>
{% endif %}

<div id="modal">
  <button onclick="document.getElementById('modal').style.display='none'">
    close ‚úñ</button>
  <h3>Top tags:</h3>
  <pre id="tagbox"></pre>
</div>

<script>
function showTags(encPath){
  fetch('{{ url_for("api_tags") }}',{
    method:'POST',
    headers:{'Content-Type':'application/x-www-form-urlencoded'},
    body:'path='+encPath
  }).then(r=>r.text()).then(t=>{
    document.getElementById('tagbox').innerText=t;
    document.getElementById('modal').style.display='block';
  });
}
</script>
</body>
</html>
